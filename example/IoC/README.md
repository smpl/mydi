# Загрузчик IoC

Этот загрузчик используется для загрузки сложных объектов.

Например при загрузке подключения к БД в случае если это тестовая среда, 
можно прямо там вернуть обычную заглушку, а в остальных случаях 
создавать реальное подключение на основе параметров, например из 
KeyValueLoader.

Также можно проинициализировать параметры после создания объекта, 
сменить схему, указать кодировку подключения и так далее.

Также с помощью контекста в котором может находиться [Locator](../Locator)
можно использовать другие контейнеры или зависимости из других [Loader](../Loader)

## Параметры

### basePath

Путь до директории в которой храниться конфигурация описывающая создание 
контейнеров

### context

Здесь хранятся параметры которые будут передаваться каждому 
конфигурационному файлу из **basePath**

## Как он работает ?

Когда [Locator](../Locator) запрашивает загрузить контейнер, **IoC** в
начале преобразует запрощенное имя в путь до файла.

Если фаил конфигурации есть то запрошенный контейнер может быть
загружен этим загрузчиком, если файла нет то контейнер не может быть 
загружен этим загрузчиком.

Перед открытием файла, он создаст переменные указанные в **context** где 
ключ этого массива это имя переменной, а значение этого ключа в массиве 
это соответсвенно значение переменной, вновь созданные переменные будут 
доступны внутри файла конфигурации.

После он откроет этот фаил и ожидает там php скрипт, который должен 
вернуть результат, IoC возьмет этот результат и передаст в **Locator**. 

В качестве результата может также быть и [ContainerInterface](../Container) 
с соответствующей обработкой в **Locator**.

В случае если конфигурация выведет что то в stdout (например echo или 
возникнет какое либо предупреждение или ошибка) загрузка будет считаться 
неуспешной.

### Преобразования имя контейнера в путь

У имени контейнера заменяются символы _ и \ на DIRECTORY_SEPARATOR и в 
начало добавляется basePath, а в конец расширение .php

например для basePath = /var/www/ioc, а для windows С:\www\ioc

Имя запрошенного контейнера **\smpl\mydi\Locator**
Путь в Linux: /var/www/ioc/Smpl/Mydi/Locator.php
Путь в Windows: C:\www\ioc\smpl\mydi\Locator.php

## Демонстрация работы

Сделаем простой пример, создадим директорию конфигурация где будет 
наша конфигурация контейнеров лежать и создадим опишем несколько
контейнеров

**testContext** контейнер должен сумировать число 10 переменной $magic 
которую мы передадим через параметр **context**.

[Описание контейнера](testContext.php)

**testContainer** в этом контейнере мы будем просто возвращать Factory 
Container в котором будет обычная функция которая при каждом вызове 
будет увеличивать счетчик вызовов и вызовем ее несколько раз.

[Описание контейнера](testContainer.php)

## Практика использования

Данный способ создания объектов не требует изучения дополнительного 
синтаксиса и позволяет легко и понятно конфигурировать, также очень 
часто конфигурации возвращают ContainerInterface в котором есть 
возможность первым аргументом функции получить LocatorInterface через 
который и получить все остальные зависимости, или Locator можно 
передавать через параметр context